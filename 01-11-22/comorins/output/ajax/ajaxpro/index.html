<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.1.min.js"
    integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
    crossorigin="anonymous"></script>
    

    <title>Resumeproject</title>
</head>
<body>
  <div class="container">
    <label for="">Name:</label>
    <input type="text" id="name" onkeyup="adddetails('name',this.value)"><br>
    <label for="">Email:</label>
    <input type="email" id="email" onkeyup="adddetails('email',this.value)"><br>
    <label for="">About me</label><br>
    <textarea name="" id="" cols="30" rows="5" onkeyup="adddetails('aboutme',this.value)"></textarea><br>
  
    <label for="">mobile no:</label>
    <input type="number" onkeyup="adddetails('phone',this.value)"><br>
    <label for="">role:</label>
    <input type="text" onkeyup="adddetails('role',this.value)"><br>
    <label for="">objective:</label><br>
    <textarea name="" id="" cols="20" rows="3" onkeyup="adddetails('objective',this.value)"></textarea><br>

    <label for="">skills:</label>
    <input type="text" onkeyup="adddetails('skills',this.value,0)">
    <input type="text" onkeyup="adddetails('skills',this.value,1)">
    <input type="text" onkeyup="adddetails('skills',this.value,2)"><br>
    <label for=""><b>Education:</b></label>
    <table class="table">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Course</th>
            <th scope="col">Year</th>
            <th scope="col">Institute</th>
            <th scope="col">Percentage</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">1</th>
            <td><input type="text" onkeyup="adddetails('education',this.value,0,'course')"></td>
            <td><input type="text"onkeyup="adddetails('education',this.value,0,'year')"></td>
            <td><input type="text" onkeyup="adddetails('education',this.value,0,'institute')"></td>
            <td><input type="number"onkeyup="adddetails('education',this.value,0,'percentage')"></td>
          </tr>
          <tr>
            <th scope="row">2</th>
            <td><input type="text" onkeyup="adddetails('education',this.value,1,'course')"></td>
            <td><input type="text"onkeyup="adddetails('education',this.value,1,'year')"></td>
            <td><input type="text" onkeyup="adddetails('education',this.value,1,'institute')"></td>
            <td><input type="number"onkeyup="adddetails('education',this.value,1,'percentage')"></td>
          </tr>
          <tr>
            <th scope="row">3</th>
            <td><input type="text" onkeyup="adddetails('education',this.value,2,'course')"></td>
            <td><input type="text"onkeyup="adddetails('education',this.value,2,'year')"></td>
            <td><input type="text" onkeyup="adddetails('education',this.value,2,'institute')"></td>
            <td><input type="number"onkeyup="adddetails('education',this.value,2,'percentage')"></td>
          </tr>
          <tr>
            <th scope="row">4</th>
            <td><input type="text" onkeyup="adddetails('education',this.value,3,'course')"></td>
            <td><input type="number"onkeyup="adddetails('education',this.value,3,'year')"></td>
            <td><input type="text" onkeyup="adddetails('education',this.value,3,'institute')"></td>
            <td><input type="number"onkeyup="adddetails('education',this.value,3,'percentage')"></td>
        </tbody>
      </table>
      <label for="">workingexperience:</label>
      <table class="table">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Organisation</th>
            <th scope="col">year</th>
            <th scope="col">role</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">1</th>
            <td><input type="text" onkeyup="adddetails('workingexperience',this.value,0,'organisation')"></td>
            <td><input type="text"onkeyup="adddetails('workingexperience',this.value,0,'exyear')"></td>
            <td><input type="text" onkeyup="adddetails('workingexperience',this.value,0,'role')"></td>
          
          </tr>
          <tr>
            <th scope="row">2</th>
            <td><input type="text" onkeyup="adddetails('workingexperience',this.value,1,'organisation')"></td>
            <td><input type="text"onkeyup="adddetails('workingexperience',this.value,1,'exyear')"></td>
            <td><input type="text" onkeyup="adddetails('workingexperience',this.value,1,'role')"></td>
          
          </tr>
          <tr>
            <th scope="row">3</th>
            <td><input type="text" onkeyup="adddetails('workingexperience',this.value,2,'organisation')"></td>
            <td><input type="text"onkeyup="adddetails('workingexperience',this.value,2,'exyear')"></td>
            <td><input type="text" onkeyup="adddetails('workingexperience',this.value,2,'role')"></td>
          
          </tr>
        
        </tbody>
      </table>
      <label for="">certification:</label>
      <input type="text" onkeyup="adddetails('certification',this.value,0)">
      <input type="text" onkeyup="adddetails('certification',this.value,1)">
      <input type="text" onkeyup="adddetails('certification',this.value,2)">
      <input type="text" onkeyup="adddetails('certification',this.value,3)"><br>
      <label for="">Area of interest:</label>
      <input type="text" onkeyup="adddetails('Areaofinterest',this.value,0)">
      <input type="text" onkeyup="adddetails('Areaofinterest',this.value,1)">
      <input type="text" onkeyup="adddetails('Areaofinterest',this.value,2)">
      <input type="text" onkeyup="adddetails('Areaofinterest',this.value,3)">
      <br>
      <label for=""><b>Personal details</b></label><br>
      <label for="">Fathername:</label>
      <input type="text" onkeyup="adddetails('personaldetails',this.value,'fathername')"><br>
      <label for="">dob:</label>
      <input type="date" onkeyup="adddetails('personaldetails',this.value,'-')"><br>
      <label for="">gender</label>
      <input type="text" onkeyup="adddetails('personaldetails',this.value,'gender')"> <br>
      <label for="">nationality:</label>)
      <input type="text" onkeyup="adddetails('personaldetails',this.value,'nationality')"><br>
      <label for="">Address:</label><br>
      <textarea name="" id="" cols="30" rows="5" onkeyup="adddetails('personaldetails',this.value,'address')"></textarea><br>
      <label for="">languagesknown:</label>
      <input type="text" onkeyup="adddetails('languagesknown',this.value,0)">
    <input type="text" onkeyup="adddetails('languagesknown',this.value,1)">
    <input type="text" onkeyup="adddetails('languagesknown',this.value,2)"><br>
    <button class="btn btn-primary submit" >submit</button>
    <div >
      <table class="table mt-5"  >
        <thead>
          <tr>
            <th scope="col">Id</th>
            <th scope="col">user</th>
            <th scope="col">Name</th>
            <th scope="col">Action</th>
            <th scope="col">View</th>
          </tr>
        </thead>
        <tbody id="obj">

        </tbody>
      </table>
      <div id="showtop"></div>
   
    </div>


  </div>
  
  <script>
    let resume={
    skills:[],
    certification:[],
    Areaofinterest:[],
    personaldetails:{},
    languagesknown:[]
   
    
}

function adddetails(key,value,index=null,mainkey=null){
    if(index==null){
        resume[key]=value

    }
    else if(key=="education"||key=="workingexperience"){
        if(!resume[key]){
            resume[key]=[]
        }
        if(!resume[key][index]){
            resume[key][index]={}     
        }
        resume[key][index][mainkey]=value
    }
    else{
       
        resume[key][index]=value
    }
}

$(function(){
  function call(){
    $.ajax({
            type:"get",
            url:"http://karka.academy/api/action.php",
            data:{
                request:"get_user_resume",
                user:"akash3"
            },
            success:function(data){
             
              let detail=JSON.parse(data)
              let fulldetail=detail.data
              console.log(fulldetail)
              let element=""
              for(let i=0;i<fulldetail.length;i++){
                let arr=JSON.parse(fulldetail[i].data)
                console.log(arr.name)
                console.log(arr.email)  
                 element=element+`
                              <tr>
                                <td>${fulldetail[i].id}</td>
                                <td>${fulldetail[i].user}</td>
                                <td>${arr.name}</td>
                                <td><button class="btn btn-primary delete" value="${fulldetail[i].id}">Delete</button></td>
                                <td><a href='view.html?name=${fulldetail[i].id}'target='_self'><button class="btn btn-primary">View</button></a></td>

                              </tr>`
                            
              }
              $("#obj").html(element)  

            }
        })
  }
 
    $(".submit").click(function(){
      event.preventDefault()
        $.ajax({
            type:"post",
            url:"http://karka.academy/api/action.php",
            data:{
                request:"create_resume",
                user:"akash3",
                resume,
            
            },
            success:function(data){
                console.log(data)
                $("#obj").html("")

            }
        })
        call()
    })
    call()
    call()
    $("body").on("click",".delete",function(){
      let del=$(this).val()
      console.log(del)
        $.ajax({
            type:"get",
            url:"http://karka.academy/api/action.php",
            data:{
                request:"delete_user_resume",
                user:"akash3",
                id:del
            },
            success:function(data){
              console.log(data)
          
           },
            error:function(){
              console.log("failed")
            }
        }),
        call()
    })
  })
  </script>   
</body>
</html>